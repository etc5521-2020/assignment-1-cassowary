---
title: "ETC5521 Assignment 1"
subtitle: "Fines or Taxes? Exploratory Data Analysis on General Data Protection Regulation Fines"
team: cassowary
author:
  - Weihao Li
  - Dang Nguyen
date: "`r Sys.Date()`"
bibliography: ref.bib
output: 
  html_document:
    citation_package: biblatex
    toc: true
    toc_float: true
    theme: cerulean
    number_sections: true
csl: apa-6th-edition.csl
---

<!-- CSS style for title page -->

<style type="text/css">

h1.title {
  text-align: center;
}
h3.subtitle {
  color: Darkred;
  text-align: center;
}
h4.author {
  color: black;
  text-align: center;
}
h4.date {
  color: black;
  text-align: center;
}
</style>


```{r setup, include=FALSE}
#Sset knitr option and system language for R kernel
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
Sys.setlocale("LC_ALL","English")
```

```{r libra}
# Load in packages
library(tidyverse)
library(lubridate)
library(kableExtra)
library(tidytext)
library(wordcloud2)
```

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}


# Introduction and motivation

General Data Protection Regulation (GDPR) is a regulation adopted in EU law on 14 April 2016, which aim to "protect fundamental rights and freedoms of natural persons and in particular their right to the protection of personal data" [@regulation2016regulation]. Since its establishment, @tikkinen2018eu stated that it would be a challenge to companies who lack of awareness of the GDPR’s practical implications. In other words, inconsistent practical and technical implementation of GDPR across companies could be anticipated. By August 2020, more than 49 companies have been fined at least 100 thousand euros. Most of these fines were issued to IT companies [@fine]. The most famous and largest GDPR fine was the 50 million euros fine issued to Google. 

Meanwhile, @eufuture suggested that EU was in a bad position on the battle to its digital future. Besides, part of the reasons behind the GDPR establishment and the later digital services taxes imposed by major EU countries were an indication that EU was waving the flag of digital sovereignty. Thus, to against digital hegemony, it intentionally targeted non-local held IT corporations.

Available data of GDPR fines from @Privacy-Affairs, provides an opportunity for us to gain insight into the privacy issues and possible abuse of articles of GDPR in EU. This dataset was originally adopted by @Tidy-Tuesday, which is a social weekly data project in R. We will provide the workflow of data collection, data cleaning and data analysis in the following sections. A potential limitation of this research is a great proportion of controller names are missing from the dataset which introduces extra difficulties of drawing accurate conclusions with respect to the company nationality.

 

# Data description

```{r}
# Source script and clean environment after running the script
if (!(file.exists("data/gdpr_text.tsv") & file.exists("data/gdpr_violations.tsv"))){
  source("scrapy.R")
  rm(list = ls())
  detach("package:rvest", unload=TRUE)
}
```

```{r data cleaning}
# Load in data
gdpr_text <- read_tsv("data/gdpr_text.tsv")
gdpr_vio <- read_tsv("data/gdpr_violations.tsv")

# Normal data cleaning
gdpr_vio <- mutate(gdpr_vio, price = if_else(price <= 0, NA_real_, price)) %>%
  mutate(date = as.Date(date, "%m/%d/%Y")) %>%
  mutate(date = if_else(date < "2010-01-01", NA_Date_, date)) %>%
  mutate(controller = if_else(controller == "Google Inc.", "Google", controller)) %>%
  mutate(controller = if_else(tolower(controller) == "unknown company", "Company", controller)) %>%
  mutate(controller = if_else(tolower(controller) %in% c("unknown", "unknwon", "unknown organization", "not known", "not disclosed", "not available"), "Unknown", controller)) %>%
  mutate(controller = if_else(tolower(controller) == "tusla child and family agency", "Tusla", controller)) %>%
  mutate(controller = if_else(tolower(controller) == "telefonica", "Telefónica SA", controller)) %>%
  mutate(controller = if_else(controller == "Vodafone España, S.A.U.", "Vodafone Espana", controller)) %>%
  mutate(controller = if_else(controller == "Vodafone Espana", "Vodafone España", controller)) %>%
  mutate(controller = if_else(tolower(controller) == "telecommunication service provider", "Telecom company", controller)) %>%
  mutate(controller = if_else(controller %in% c("Private person", "Private person"), "Private individual", controller)) %>%
  mutate(controller = if_else(controller %in% c("A bank", "bank", "Bank (unknown)"), "Bank", controller)) %>%
  mutate(controller = if_else(controller == "A mayor", "Mayor", controller)) %>%
  mutate(controller = if_else(controller == "bank", "Bank", controller)) %>%
  mutate(article_violated = if_else(article_violated == "Failure to implement sufficient measures to ensure information security", "Art.32 GDPR", article_violated))
  
  
```


The data is scraped from @Privacy-Affairs by @Ellis-Hughes, posted on @Tidy-Tuesday. We adapted the scripts they used and removed duplication of GDPR fines due to multiple sources. We collected data from 2018-05-12 to 2020-08-21. Besides, abnormal values including fines with 0 price, which indicate ongoing trails and fines before the establishment of the GDPR, which are obviously missing value, are set to be NA. All records with missing date are set to NA.
We also further process inconsistency in corporation names. There are unnamed organizations that were fined by GDPR. In this report, all unnamed organizations are labelled as "Unknown". 

The data consist of two smaller dataset:

1. `GDPR_Violations.tsv` contains information of `r nrow(gdpr_vio)` fines and penalties which data protection authorities in EU have imposed under EU General Data Protection Regulation (GDPR). The dataset contains variables including the country and authority, the date of violation, the fine price of violation in Euros, the controller that violate the rule, ... Detailed information of variable is presented below.
 
2. `GDPR_text.tsv` contains `r nrow(gdpr_text)` articles of actual GDPR legal document. 

## Data Dictionary

### `gdpr_violations.tsv`

|variable         |class     |description |
|:---------------|:--------|:----------|
|id               |integer   |Idetifier for fine/violation |
|picture          |character | SVG image of violation country flag |
|name             |character | Name of country where violation was enforced |
|price            |integer   | Fine price in Euros (€) |
|authority        |character | Authority that enacted the violation |
|date             |character | Date of violation |
|controller       |character | Controller of data - the violator |
|article_violated |character | Specific GDPR Article violated (see the `gdpr_text.tsv` data for specifics) |
|type             |character | Type of violation |
|source           |character | Original source (URL) of fine data |
|summary          |character | Summary of violation |

###  `gdpr_text.tsv`

|variable      |class     |description |
|:-------------|:---------|:-----------|
|chapter       |double    | GDPR Chapter Number |
|chapter_title |character | Chapter title |
|article       |double    | GDPR Article number|
|article_title |character | Article title|
|sub_article   |double    | Sub article number |
|gdpr_text     |character | Raw text of article/subarticle|
|href          |character | URL to the raw text itself|


## Research questions

The overall aim of this research is to reveal the privacy issues in cyberspace within the EU and examine whether General Data Protection Regulation fines were used as another type of "digital services tax" imposed on multinational technology corporations.

Three secondary questions are addressed in this research:

1. What were the characteristics of GDPR fines across countries, time and corporations? Did certain countries target certain corporations at certain time?
2. Which articles and regulations were more likely to be violated? And how much they commonly charged? Was there any article and regulation being abused?
3. What were the key arguments in each article, especially articles referenced the most in GDPR fines? How did it reflect the privacy issues in the EU?


# Analysis and findings

## Characteristics of GDPR fines across countries, time and corporations

```{r plot 1}
# Draws multiple boxplots on different layers to display different colors
gdpr_vio %>%
  filter(!is.na(date)) %>%
  ggplot() +
  geom_boxplot(aes(factor(month(date)), price), outlier.color = "#D7261E") +
  geom_boxplot(data = filter(gdpr_vio, date<"2019-09-01"|date>"2020-04-01"),
               aes(factor(month(date)), price), outlier.color = "black") +
  geom_point(data = filter(filter(gdpr_vio, month(date) == 3, year(date) == 2020), 
                           price == min(price, na.rm = T)),
             aes(factor(month(date)), price)) +
  facet_wrap(~year(date)) +
  xlab("Month") + 
  ylab("Price (log10 scale)") +
  scale_y_log10()  +
  ggtitle("Boxplot of GDPR fines across time, 2018-2020")  +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r plot2}
# Hightlight some bars
gdpr_vio %>%
  filter(!is.na(date)) %>%
  ggplot() +
  geom_bar(aes(factor(month(date)), fill = date >="2019-10-01" & date <="2020-03-31" | month(date) == 6 & year(date) == 2020)) +
  facet_wrap(~year(date)) +
  ylab("Number of Violations") +
  xlab("Month") +
  scale_fill_manual(values = c("navyblue", "#D7261E")) +
  labs(title = "Number of GDPR Violations, 2018-2020") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")
  

```

```{r plot3}
# Sort boxplots by median price
gdpr_vio %>%
  filter(!is.na(price)) %>%
  group_by(name) %>%
  summarise(md = median(price, na.rm = TRUE)) %>%
  right_join(filter(gdpr_vio, !is.na(price))) %>%
  ggplot() +
  geom_boxplot(aes(price, fct_reorder(name, md, .desc = T))) +
  scale_x_log10() +
  ylab("Country") + 
  xlab("Price (log10 scale)") +
  ggtitle("Boxplot of GDPR fines by country") +
  theme(plot.title = element_text(hjust = 0.5))
  
```

```{r plot4-Thanh}
gdpr_vio %>% group_by(name) %>% summarise (count = n()) %>%
  ggplot(aes(x = count, y = fct_reorder(name, count))) +
  geom_bar(stat = "identity", aes(fill = count>50)) +
  xlab("Number of Violations")+
  ylab("Country") +
  labs(title = "Number of GDPR Violations by country") +
  scale_fill_manual(values = c("navyblue", "#D7261E")) + 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")

```


```{r table1}
# Detail table
gdpr_vio %>%
  filter(!is.na(date)) %>%
  arrange(date) %>%
  group_by(controller) %>%
  summarise(total_price = sum(price, na.rm = TRUE), 
            count = n(), 
            countries = paste(unique(name), collapse = ", "),
            date = paste(unique(paste0(year(date), "-", month(date))), collapse = ", ")) %>%
  filter(!controller %in% c("Unknown", "Company", "Private individual", "Bank", "Telecom company", "Restaurant", "Hospital")) %>%
  arrange(desc(total_price))%>%
  head(10) %>%
  knitr::kable(caption = "Largest cumulative GDPR fines by corporation: Companies with background in red are owned by corporations or individuals outside EU.",
               col.names = c("Controller", "Cumulative_price", "Count", "Countries", "Date")) %>%
  row_spec(c(1,4,10), bold = T, color = "white", background = "#D7261E") %>%
  kable_styling(full_width = F, "hover")
  
```





```{r table2}
# Vodafone only
gdpr_vio %>%
  filter(!is.na(date)) %>%
  filter(grepl("Vodafone", controller)) %>%
  select(date, name, controller, price) %>%
  group_by(controller, country = name) %>%
  summarise(total_price = sum(price, na.rm = T),
            count = n(),
            date = paste(unique(paste0(year(date), "-", month(date))), collapse = ", ")
            ) %>%
  knitr::kable(caption = "GDPR fines issued to Vodafone", 
               col.names = c("Controller", "Countries", "Cumulative_price", "Count", "Date")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```




[FILL] Should include at least one plot or numerical summary for each of your questions, that helps the reader arrive at an answer. You should also write paragraphs describing the methods, summaries and findings. 

## Analysis of violated article

```{r art-plot}
# Init a list
art_list <- list()

# Iterating all articles
for (i in 1:100){
  
  # Define a pattern
  txt <- paste0("art. ", i, " ")
  
  # Match patterns with vector of lower case string
  art_list[[i]] <- grepl(txt, tolower(gdpr_vio$article_violated), fixed = TRUE)
  
  # Define another pattern
  txt <- paste0("art. ", i, "(")
  
  # Match again and add them together (Note: TRUE = 1, FALSE = 0)
  art_list[[i]] <- art_list[[i]] + grepl(txt, tolower(gdpr_vio$article_violated), fixed = TRUE)
  txt <- paste0("art.", i, " ")
  art_list[[i]] <- art_list[[i]] + grepl(txt, tolower(gdpr_vio$article_violated), fixed = TRUE)
  txt <- paste0("art ", i, " ")
  art_list[[i]] <- art_list[[i]] + grepl(txt, tolower(gdpr_vio$article_violated), fixed = TRUE)
  
  # As long as it matches with any pattern above, mark it as TRUE
  art_list[[i]] <- art_list[[i]] > 0
}

# Add up all logical values for each article (lapply), unlist them as a vector
data.frame(id = paste0("Art. ", 1:100), count = unlist(lapply(art_list, sum))) %>%
  filter(count > 0) %>%
  ggplot() +
  geom_bar(aes(y = fct_reorder(id, count), x = count, fill = count > 50), stat = "identity") +
  xlab("Number of violation") +
  ylab("Article number") +
  labs(title = "Number of GDPR violations by article") + 
  scale_fill_manual(values = c("navyblue", "#D7261E")) +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")
  
```


```{r}
# Init a list
price_list <- NULL

for (i in 1:100){
  # for each article, retrieve all prices from the GDPR fine dataset if they violate that article
  if (is.null(price_list)){
    # Init the data frame
    price_list <- data.frame(id = rep(i, length(gdpr_vio$price[art_list[[i]]])), price = gdpr_vio$price[art_list[[i]]])
  } else {
    # Bind prices together
    price_list <- bind_rows(price_list, data.frame(id = rep(i, length(gdpr_vio$price[art_list[[i]]])), price = gdpr_vio$price[art_list[[i]]]))
  }
}

# Sort boxplots by median price

price_list %>%
  filter(!is.na(price)) %>%
  group_by(id) %>%
  summarise(price = price, md = median(price)) %>%
  ungroup() %>%
  ggplot() +
  geom_boxplot(aes(price, y = fct_reorder(paste0("Art. ", id), md, .desc = T), col = id %in% c(5,6,32))) +
  scale_color_manual(values = c("grey35", "#D7261E")) +
  scale_x_log10() +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none") +
  xlab("Price (log10 scale)") +
  ylab("Article number") +
  ggtitle("GDPR fines by article")
```


## Text mining GDPR articles

```{r}
# Create word frequency and anti join useless words
word_list <- gdpr_text %>%
  select(article, text = gdpr_text) %>%
  unnest_tokens(word, text) %>%
  group_by(article, word) %>%
  summarise(count = n()) %>%
  anti_join(stop_words, by = 'word') %>%
  filter(!grepl("\\d", word)) %>%
  arrange(article, desc(count))
```

### Overview of words in GDPR articles

```{r overall}

# Drop article attribute
temp <- data.frame(word = word_list$word, count = word_list$count)

# Use the first 1200 words to build word cloud
temp <- temp %>%
  filter(!grepl("\\d", word)) %>%
  group_by(word) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  arrange(desc(count)) %>%
  head(1200)

wordcloud2(temp, size = 0.3)

```

## Words in Article 5, 6 and 32 respectively

```{r}
# List the top 5 words
word_list %>%
  filter(article %in% c(5,6,32)) %>%
  filter(!grepl("\\d", word)) %>%
  arrange(article, desc(count)) %>%
  group_by(article) %>%
  summarise(word = word[1:5], count = count[1:5]) %>%
  knitr::kable(caption = "Top 5 most common words for article 5, 6 and 32 respectively") %>%
  row_spec(c(1:5,11:15), color = "black", background = "lightgrey") %>%
  kable_styling(full_width = T, "hover")
  
```


## Overview of trigrams in GDPR articles

```{r}
# Extract trigrams

word_list <- gdpr_text %>%
  select(article, text = gdpr_text) %>%
  unnest_tokens(trigram, text, token = 'ngrams', n = 3) %>%
  group_by(article, trigram) %>%
  summarise(count = n()) %>%
  separate(trigram, c('word1', 'word2', 'word3'), sep =' ') %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
  filter(!word3 %in% stop_words$word) %>%
  unite(trigram, word1, word2, word3, sep =' ') %>%
  filter(!grepl("\\d", trigram)) %>%
  arrange(article, desc(count))
```


```{r}
# Drop article attribute
temp <- data.frame(word = word_list$trigram, count = word_list$count)

# Use the trigrams to build word cloud
temp <- temp %>%
  filter(!grepl("\\d", word)) %>%
  group_by(word) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  arrange(desc(count))

wordcloud2(temp, size = 0.2)
```





# Acknowledgement

Following R packages are used in producing this research:



# References

